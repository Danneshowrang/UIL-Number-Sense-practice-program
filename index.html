<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UIL Number Sense Practice - Pattern Based</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Consolas', 'Monaco', monospace;
        }
        
        body {
            background-color: #f5f5f5;
            color: #333;
            line-height: 1.6;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .container {
            background: white;
            border: 1px solid #ddd;
            border-radius: 2px;
            padding: 30px;
            margin: 20px 0;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }
        
        h1, h2, h3 {
            font-weight: normal;
            margin-bottom: 20px;
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
        }
        
        h1 {
            text-align: center;
            font-size: 28px;
            color: #222;
        }
        
        .menu {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin: 30px 0;
        }
        
        .menu-item {
            background: #f8f8f8;
            border: 1px solid #ddd;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
            user-select: none;
        }
        
        .menu-item:hover {
            background: #f0f0f0;
            border-color: #ccc;
        }
        
        .menu-item:active {
            background: #e8e8e8;
        }
        
        .problem-display {
            background: #fafafa;
            border: 1px solid #ddd;
            padding: 30px;
            margin: 20px 0;
            min-height: 150px;
            font-size: 20px;
            white-space: pre-wrap;
        }
        
        .input-area {
            margin: 20px 0;
        }
        
        input[type="text"], input[type="number"] {
            width: 100%;
            padding: 12px;
            font-size: 18px;
            border: 1px solid #ddd;
            margin: 10px 0;
        }
        
        button {
            background: #333;
            color: white;
            border: none;
            padding: 12px 24px;
            font-size: 16px;
            cursor: pointer;
            margin: 5px;
            transition: background 0.2s;
        }
        
        button:hover {
            background: #555;
        }
        
        button:disabled {
            background: #aaa;
            cursor: not-allowed;
        }
        
        .results {
            background: #f8f8f8;
            border: 1px solid #ddd;
            padding: 20px;
            margin: 20px 0;
        }
        
        .timer-area {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 10px 0;
            padding: 10px;
            background: #f8f8f8;
            border: 1px solid #ddd;
        }
        
        .timer {
            font-size: 18px;
            font-weight: bold;
            text-align: right;
        }
        
        .stopwatch {
            font-size: 18px;
            font-weight: bold;
            text-align: left;
        }
        
        .feedback {
            padding: 15px;
            margin: 15px 0;
            border-left: 4px solid #333;
            background: #f9f9f9;
            min-height: 80px;
        }
        
        .correct { color: #2e7d32; }
        .incorrect { color: #c62828; }
        .skipped { color: #666; }
        
        .hidden {
            display: none;
        }
        
        .controls {
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 10px;
            margin: 20px 0;
        }
        
        .problem-counter {
            font-size: 16px;
            color: #666;
            margin: 10px 0;
        }
        
        .answer-submitted {
            pointer-events: none;
            opacity: 0.7;
        }
        
        .stopwatch-controls {
            display: flex;
            gap: 5px;
            margin-left: 10px;
        }
        
        .stopwatch-controls button {
            padding: 4px 8px;
            font-size: 12px;
            background: #666;
        }
        
        .stopwatch-controls button:hover {
            background: #888;
        }
        
        .problem-info {
            font-size: 14px;
            color: #666;
            margin: 5px 0;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            .menu {
                grid-template-columns: 1fr;
            }
            
            .problem-display {
                font-size: 18px;
                padding: 20px;
            }
            
            button {
                width: 100%;
                margin: 5px 0;
            }
            
            .timer-area {
                flex-direction: column;
                gap: 10px;
                text-align: center;
            }
            
            .stopwatch-controls {
                margin-left: 0;
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>UIL Number Sense Practice - Pattern Based</h1>
        
        <div id="main-menu">
            <div class="menu">
                <div class="menu-item" onclick="startQuickPractice()">
                    <h3>Quick Practice</h3>
                    <p>10 problems with stopwatch</p>
                </div>
                <div class="menu-item" onclick="startFullTest()">
                    <h3>Full Test Simulation</h3>
                    <p>80 problems, 10 minute timer</p>
                </div>
                <div class="menu-item" onclick="showSectionMenu()">
                    <h3>Practice by Test Section</h3>
                    <p>Problems 1-20, 21-40, etc.</p>
                </div>
                <div class="menu-item" onclick="showCategoryMenu()">
                    <h3>Practice by Problem Type</h3>
                    <p>Focus on specific math topics</p>
                </div>
                <div class="menu-item" onclick="startEstimationPractice()">
                    <h3>Estimation Practice</h3>
                    <p>Starred (*) problems only</p>
                </div>
                <div class="menu-item" onclick="reviewMissed()">
                    <h3>Review Missed Problems</h3>
                    <p>Learn from mistakes</p>
                </div>
                <div class="menu-item" onclick="showPatternInfo()">
                    <h3>Pattern Analysis</h3>
                    <p>See problem patterns learned</p>
                </div>
                <div class="menu-item" onclick="showInstructions()">
                    <h3>Instructions</h3>
                    <p>How to use</p>
                </div>
            </div>
        </div>
        
        <div id="section-menu" class="hidden">
            <h2>Practice by Test Section</h2>
            <div class="menu">
                <div class="menu-item" onclick="startSectionPractice(0)">Problems 1-20 (Basic Arithmetic)</div>
                <div class="menu-item" onclick="startSectionPractice(1)">Problems 21-40 (Algebra/Geometry)</div>
                <div class="menu-item" onclick="startSectionPractice(2)">Problems 41-60 (Advanced Topics)</div>
                <div class="menu-item" onclick="startSectionPractice(3)">Problems 61-70 (Trig/Matrices)</div>
                <div class="menu-item" onclick="startSectionPractice(4)">Problems 71-80 (Calculus)</div>
                <div class="menu-item" onclick="showMainMenu()">Back to Main Menu</div>
            </div>
        </div>
        
        <div id="category-menu" class="hidden">
            <h2>Practice by Problem Type</h2>
            <div class="menu">
                <div class="menu-item" onclick="startCategoryPractice('arithmetic')">Arithmetic Operations</div>
                <div class="menu-item" onclick="startCategoryPractice('fractions')">Fractions/Decimals/Percents</div>
                <div class="menu-item" onclick="startCategoryPractice('algebra')">Algebra & Equations</div>
                <div class="menu-item" onclick="startCategoryPractice('geometry')">Geometry & Measurement</div>
                <div class="menu-item" onclick="startCategoryPractice('sequences')">Sequences & Series</div>
                <div class="menu-item" onclick="startCategoryPractice('estimation')">Estimation Problems</div>
                <div class="menu-item" onclick="showMainMenu()">Back to Main Menu</div>
            </div>
        </div>
        
        <div id="practice-screen" class="hidden">
            <div class="timer-area">
                <div class="stopwatch" id="stopwatch">
                    <span id="stopwatch-display">00:00:00</span>
                    <div class="stopwatch-controls">
                        <button id="stopwatch-start" onclick="startStopwatch()">▶</button>
                        <button id="stopwatch-pause" onclick="pauseStopwatch()">⏸</button>
                        <button id="stopwatch-reset" onclick="resetStopwatch()">↺</button>
                    </div>
                </div>
                <div class="timer" id="timer">Time: --:--</div>
            </div>
            
            <div class="problem-counter" id="problem-counter">Problem 1 of 10</div>
            <div class="problem-info" id="problem-info"></div>
            <div class="problem-display" id="problem-display"></div>
            
            <div class="input-area">
                <input type="text" id="answer-input" placeholder="Type your answer here..." autocomplete="off">
                <div class="controls">
                    <button id="submit-btn" onclick="submitAnswer()">Submit Answer</button>
                    <button id="next-btn" onclick="nextQuestion()" class="hidden">Next Question</button>
                    <button onclick="skipProblem()">Skip Problem</button>
                    <button onclick="quitPractice()">Quit Practice</button>
                </div>
            </div>
            
            <div id="feedback" class="feedback hidden"></div>
        </div>
        
        <div id="results-screen" class="hidden">
            <h2>Results</h2>
            <div id="results-display" class="results"></div>
            <div class="controls">
                <button onclick="reviewMissed()">Review Missed Problems</button>
                <button onclick="showMainMenu()">Back to Main Menu</button>
            </div>
        </div>
        
        <div id="review-screen" class="hidden">
            <h2>Review Missed Problems</h2>
            <div id="review-display" class="results"></div>
            <div class="controls">
                <button onclick="previousReview()">Previous</button>
                <button onclick="nextReview()">Next</button>
                <button onclick="showMainMenu()">Back to Main Menu</button>
            </div>
        </div>
        
        <div id="pattern-info" class="hidden">
            <h2>Pattern Analysis from UIL Tests</h2>
            <div class="results">
                <h3>Patterns Learned from 16 UIL Tests (2023-2025):</h3>
                <p><strong>Problems 1-10:</strong> Basic arithmetic with current year references, fraction/decimal conversions, simple percentages</p>
                <p><strong>Problems 11-20:</strong> Order of operations, multiplication tricks (×11, ×25), remainders, averages</p>
                <p><strong>Problems 21-30:</strong> Algebra substitution, simple equations, geometry formulas, sequences</p>
                <p><strong>Problems 31-40:</strong> Mixed number multiplication patterns, base conversions, estimation</p>
                <p><strong>Problems 41-50:</strong> Advanced sequences, binomial theorem beginnings, coordinate geometry</p>
                <p><strong>Problems 51-60:</strong> Probability, complex numbers, logarithmic patterns</p>
                <p><strong>Problems 61-70:</strong> Trigonometry, matrices, vectors, composite functions</p>
                <p><strong>Problems 71-80:</strong> Calculus (derivatives, integrals, limits), modular arithmetic</p>
                
                <h3>Common Number Patterns Found:</h3>
                <p>• Year numbers (2023, 2024, 2025) often appear in early problems</p>
                <p>• Mixed numbers often use denominators 4, 5, 7, 8, 9</p>
                <p>• Multiplication by 11/25/75 have special shortcut patterns</p>
                <p>• Estimation problems allow ±5% error</p>
                <p>• Sequences often follow Fibonacci or triangular number patterns</p>
            </div>
            <button onclick="showMainMenu()">Back to Main Menu</button>
        </div>
        
        <div id="instructions" class="hidden">
            <h2>Instructions</h2>
            <div class="results">
                <h3>How to Use:</h3>
                <p>1. Choose a practice mode from the main menu</p>
                <p>2. Solve problems mentally - no calculator!</p>
                <p>3. Type your answer in the input box</p>
                <p>4. Click "Submit Answer" to check</p>
                <p>5. Click "Next Question" to continue</p>
                <p>6. Use 'Skip' if you don't know the answer</p>
                <p>7. Use 'Quit' to end any session early</p>
                <p>8. Review missed problems to learn from mistakes</p>
                <br>
                <h3>About the Pattern-Based Generator:</h3>
                <p>• Problems are generated based on analysis of 16 real UIL tests</p>
                <p>• Each problem follows UIL patterns but with new numbers</p>
                <p>• Difficulty matches real UIL Invitation/State tests</p>
                <p>• Problems appear in correct UIL sequence order</p>
                <br>
                <h3>Keyboard Shortcuts:</h3>
                <p>• Enter: Submit answer</p>
                <p>• N: Next question (after submission)</p>
                <p>• Esc: Skip problem</p>
                <p>• Q: Quit practice</p>
            </div>
            <button onclick="showMainMenu()">Back to Main Menu</button>
        </div>
    </div>

    <script>
        // ===== PATTERN-BASED PROBLEM GENERATOR =====
        // Analyzed from 16 UIL tests (2023-2025)
        
        // Utility functions
        function randomInt(min, max) {
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }
        
        function randomChoice(arr) {
            return arr[Math.floor(Math.random() * arr.length)];
        }
        
        function gcd(a, b) {
            return b === 0 ? a : gcd(b, a % b);
        }
        
        // Current year for year-referencing problems
        const currentYear = 2026;
        const lastTwoDigits = currentYear % 100;
        
        // ===== PROBLEM PATTERNS BY SECTION =====
        // Based on analysis of 16 UIL tests and sequencing chart
        
        const problemPatterns = {
            // ===== PROBLEMS 1-20 (Basic Arithmetic) =====
            "1-20": [
                // Problem 1-2: Year-based arithmetic
                function() {
                    const year = currentYear;
                    const reverse = parseInt(year.toString().split('').reverse().join(''));
                    const subtract = randomInt(100, 300);
                    const problem = `${year} - ${reverse} = ______`;
                    const answer = (year - reverse).toString();
                    return {
                        problem: problem,
                        answer: answer,
                        type: "Subtraction with year",
                        category: "arithmetic",
                        starred: false,
                        hint: `${year} - ${reverse} = ${answer}`
                    };
                },
                
                // Problem 3-4: Basic fraction addition
                function() {
                    const denoms = [2, 4, 8, 5, 10];
                    const denom = randomChoice(denoms);
                    const num1 = randomInt(1, denom-1);
                    const num2 = randomInt(1, denom-1);
                    const sum = num1 + num2;
                    let answer, hint;
                    
                    if (sum <= denom) {
                        answer = `${sum}/${denom}`;
                        hint = `${num1}/${denom} + ${num2}/${denom} = ${sum}/${denom}`;
                    } else {
                        const whole = Math.floor(sum / denom);
                        const remainder = sum % denom;
                        answer = `${whole} ${remainder}/${denom}`;
                        hint = `${num1}/${denom} + ${num2}/${denom} = ${sum}/${denom} = ${answer}`;
                    }
                    
                    return {
                        problem: `${num1}/${denom} + ${num2}/${denom} = ______ (fraction)`,
                        answer: answer,
                        type: "Fraction addition",
                        category: "fractions",
                        starred: false,
                        hint: hint
                    };
                },
                
                // Problem 5-6: Decimal operations
                function() {
                    const tens = randomInt(1, 9);
                    const ones = randomInt(0, 9);
                    const tenths = randomInt(1, 9);
                    const num = parseFloat(`${tens}${ones}.${tenths}`);
                    const multiplier = randomChoice([0.1, 0.2, 0.25, 0.5, 2, 4, 5, 10]);
                    const answer = (num * multiplier).toFixed(2);
                    return {
                        problem: `${num} × ${multiplier} = ______ (decimal)`,
                        answer: answer,
                        type: "Decimal multiplication",
                        category: "arithmetic",
                        starred: false,
                        hint: `${num} × ${multiplier} = ${answer}`
                    };
                },
                
                // Problem 7-8: Squares (11-25)
                function() {
                    const num = randomInt(11, 25);
                    return {
                        problem: `${num}² = ______`,
                        answer: (num * num).toString(),
                        type: "Squares",
                        category: "arithmetic",
                        starred: false,
                        hint: `${num} × ${num} = ${num * num}`
                    };
                },
                
                // Problem 9-10: Percent to fraction
                function() {
                    const percents = [
                        [25, "1/4"],
                        [33, "1/3"],
                        [50, "1/2"],
                        [66, "2/3"],
                        [75, "3/4"],
                        [20, "1/5"],
                        [40, "2/5"],
                        [60, "3/5"],
                        [80, "4/5"],
                        [12.5, "1/8"],
                        [37.5, "3/8"],
                        [62.5, "5/8"],
                        [87.5, "7/8"]
                    ];
                    const [percent, fraction] = randomChoice(percents);
                    return {
                        problem: `${percent}% = ______ (fraction)`,
                        answer: fraction,
                        type: "Percent conversion",
                        category: "fractions",
                        starred: false,
                        hint: `${percent}% = ${percent}/100 = ${fraction}`
                    };
                },
                
                // Problem 11-12: Order of operations
                function() {
                    const a = randomInt(2, 9);
                    const b = randomInt(2, 9);
                    const c = randomInt(2, 9);
                    const d = randomInt(2, 9);
                    const problem = `${a} + ${b} × ${c} - ${d} ÷ 2 = ______`;
                    const answer = (a + (b * c) - (d / 2)).toString();
                    return {
                        problem: problem,
                        answer: answer,
                        type: "Order of operations",
                        category: "arithmetic",
                        starred: false,
                        hint: `Multiply and divide first: ${b}×${c}=${b*c}, ${d}÷2=${d/2}, then ${a}+${b*c}-${d/2}=${answer}`
                    };
                },
                
                // Problem 13-14: Multiplication by 11 trick
                function() {
                    const tens = randomInt(1, 9);
                    const ones = randomInt(0, 9);
                    const sum = tens + ones;
                    let answer, hint;
                    
                    if (sum < 10) {
                        answer = `${tens}${sum}${ones}`;
                        hint = `${tens}${ones} × 11 = ${tens}${sum}${ones}`;
                    } else {
                        answer = `${tens+1}${sum-10}${ones}`;
                        hint = `${tens}${ones} × 11 = ${tens+1}${sum-10}${ones}`;
                    }
                    
                    return {
                        problem: `${tens}${ones} × 11 = ______`,
                        answer: answer,
                        type: "Multiplication trick",
                        category: "arithmetic",
                        starred: false,
                        hint: hint
                    };
                },
                
                // Problem 15-16: Remainders
                function() {
                    const divisors = [3, 4, 5, 6, 7, 8, 9, 11];
                    const divisor = randomChoice(divisors);
                    let number = randomInt(100, 999);
                    // Ensure it's not evenly divisible
                    number = Math.floor(number / divisor) * divisor + randomInt(1, divisor-1);
                    return {
                        problem: `${number} ÷ ${divisor} has remainder ______`,
                        answer: (number % divisor).toString(),
                        type: "Remainders",
                        category: "arithmetic",
                        starred: false,
                        hint: `${number} mod ${divisor} = ${number % divisor}`
                    };
                },
                
                // Problem 17-18: Averages
                function() {
                    const count = randomInt(3, 5);
                    const numbers = [];
                    let sum = 0;
                    for (let i = 0; i < count; i++) {
                        const num = randomInt(10, 100);
                        numbers.push(num);
                        sum += num;
                    }
                    const avg = (sum / count).toFixed(1);
                    return {
                        problem: `Average of ${numbers.join(", ")} = ______`,
                        answer: avg,
                        type: "Averages",
                        category: "arithmetic",
                        starred: false,
                        hint: `Sum: ${sum}, Count: ${count}, Average = ${sum} ÷ ${count} = ${avg}`
                    };
                },
                
                // Problem 19-20: Unit conversion
                function() {
                    const type = randomChoice(["inches-feet", "feet-yards"]);
                    if (type === "inches-feet") {
                        const feet = randomInt(2, 6);
                        const inches = randomInt(0, 11);
                        const totalInches = feet * 12 + inches;
                        return {
                            problem: `${feet} ft ${inches} in = ______ in`,
                            answer: totalInches.toString(),
                            type: "Unit conversion",
                            category: "geometry",
                            starred: false,
                            hint: `${feet} ft × 12 = ${feet*12} in, + ${inches} in = ${totalInches} in`
                        };
                    } else {
                        const yards = randomInt(2, 5);
                        const feet = randomInt(0, 2);
                        const totalFeet = yards * 3 + feet;
                        return {
                            problem: `${yards} yd ${feet} ft = ______ ft`,
                            answer: totalFeet.toString(),
                            type: "Unit conversion",
                            category: "geometry",
                            starred: false,
                            hint: `${yards} yd × 3 = ${yards*3} ft, + ${feet} ft = ${totalFeet} ft`
                        };
                    }
                }
            ],
            
            // ===== PROBLEMS 21-40 (Algebra/Geometry) =====
            "21-40": [
                // Problem 21-22: Simple algebra substitution
                function() {
                    const x = randomInt(2, 10);
                    const expression = randomChoice([
                        `x² - ${2*x}x + ${x*x}`,
                        `x² + ${2*x}x + ${x*x}`,
                        `x³ - ${3*x}x² + ${3*x*x}x - ${x*x*x}`
                    ]);
                    const answer = eval(expression.replace(/x/g, x.toString()));
                    return {
                        problem: `If x = ${x}, then ${expression} = ______`,
                        answer: answer.toString(),
                        type: "Algebra substitution",
                        category: "algebra",
                        starred: false,
                        hint: `Substitute x=${x}: ${expression} = ${answer}`
                    };
                },
                
                // Problem 23-24: Mixed number multiplication pattern
                function() {
                    const denominators = [4, 5, 7, 8, 9];
                    const denom = randomChoice(denominators);
                    const whole = randomInt(4, 9);
                    const num1 = randomInt(1, denom-1);
                    const num2 = denom - num1;
                    
                    // Calculate: (whole + num1/denom) × (whole + num2/denom)
                    const value1 = whole + num1/denom;
                    const value2 = whole + num2/denom;
                    const product = value1 * value2;
                    
                    // Convert to mixed number
                    const productFraction = product * denom * denom;
                    const wholePart = Math.floor(product);
                    const numerator = Math.round((product - wholePart) * denom * denom);
                    
                    let answer;
                    if (numerator === 0) {
                        answer = wholePart.toString();
                    } else {
                        const divisor = gcd(numerator, denom * denom);
                        answer = `${wholePart} ${numerator/divisor}/${(denom*denom)/divisor}`;
                    }
                    
                    return {
                        problem: `${whole}${num1}/${denom} × ${whole}${num2}/${denom} = ______ (mixed number)`,
                        answer: answer,
                        type: "Mixed number pattern",
                        category: "fractions",
                        starred: false,
                        hint: `(${whole*denom + num1}/${denom}) × (${whole*denom + num2}/${denom}) = ${answer}`
                    };
                },
                
                // Problem 25-26: Base conversion
                function() {
                    const base = randomChoice([5, 6, 7, 8]);
                    const decimal = randomInt(20, 100);
                    let temp = decimal;
                    let converted = "";
                    while (temp > 0) {
                        converted = (temp % base).toString() + converted;
                        temp = Math.floor(temp / base);
                    }
                    return {
                        problem: `${decimal} base 10 = ______ base ${base}`,
                        answer: converted,
                        type: "Base conversion",
                        category: "algebra",
                        starred: false,
                        hint: `${decimal}₁₀ = ${converted}₍${base}₎`
                    };
                },
                
                // Problem 27-28: Solving equations
                function() {
                    const a = randomInt(2, 6);
                    const b = randomInt(1, 10);
                    const c = a * 3 + b;
                    const problem = `${a}x + ${b} = ${c}`;
                    const x = (c - b) / a;
                    return {
                        problem: `${problem}, then x = ______`,
                        answer: x.toString(),
                        type: "Linear equation",
                        category: "algebra",
                        starred: false,
                        hint: `${a}x = ${c} - ${b} = ${c-b}, so x = ${c-b} ÷ ${a} = ${x}`
                    };
                },
                
                // Problem 29-30: Estimation (starred)
                function() {
                    const base = randomInt(30, 70);
                    const square = base * base;
                    const offset = randomInt(-100, 100);
                    const number = square + offset;
                    const estimate = Math.round(Math.sqrt(number));
                    return {
                        problem: `√${number} ≈ ______ (nearest integer)`,
                        answer: estimate.toString(),
                        type: "Estimation",
                        category: "estimation",
                        starred: true,
                        hint: `Between ${base-1}²=${(base-1)*(base-1)} and ${base+1}²=${(base+1)*(base+1)}`
                    };
                },
                
                // Problem 31-32: Geometry - area
                function() {
                    const length = randomInt(5, 15);
                    const width = randomInt(3, 10);
                    return {
                        problem: `Rectangle: ${length}" by ${width}", area = ______ sq in`,
                        answer: (length * width).toString(),
                        type: "Area",
                        category: "geometry",
                        starred: false,
                        hint: `Area = length × width = ${length} × ${width} = ${length*width}`
                    };
                },
                
                // Problem 33-34: Sequences
                function() {
                    const start = randomInt(1, 10);
                    const diff = randomInt(2, 5);
                    const terms = randomInt(5, 8);
                    let sequence = [];
                    let sum = 0;
                    for (let i = 0; i < terms; i++) {
                        const term = start + i * diff;
                        sequence.push(term);
                        sum += term;
                    }
                    return {
                        problem: `${sequence.join(" + ")} = ______`,
                        answer: sum.toString(),
                        type: "Arithmetic sequence",
                        category: "sequences",
                        starred: false,
                        hint: `Arithmetic series: ${terms} terms, average = (${sequence[0]} + ${sequence[sequence.length-1]})/2 = ${(sequence[0]+sequence[sequence.length-1])/2}, sum = ${sum}`
                    };
                },
                
                // Problem 35-36: Percentage increase/decrease
                function() {
                    const original = randomInt(20, 100);
                    const percent = randomInt(10, 50);
                    const increase = Math.round(original * percent / 100);
                    const newAmount = original + increase;
                    return {
                        problem: `${original} increased by ${percent}% = ______`,
                        answer: newAmount.toString(),
                        type: "Percent change",
                        category: "fractions",
                        starred: false,
                        hint: `${percent}% of ${original} = ${increase}, ${original} + ${increase} = ${newAmount}`
                    };
                },
                
                // Problem 37-38: Pythagorean triples
                function() {
                    const triples = [
                        [3, 4, 5],
                        [5, 12, 13],
                        [6, 8, 10],
                        [7, 24, 25],
                        [8, 15, 17],
                        [9, 12, 15],
                        [10, 24, 26]
                    ];
                    const [a, b, c] = randomChoice(triples);
                    const given = randomChoice([0, 1, 2]);
                    let problem, answer;
                    
                    if (given === 0) {
                        problem = `Right triangle: legs ${b} and ${c}, hypotenuse = ______`;
                        answer = a.toString();
                    } else if (given === 1) {
                        problem = `Right triangle: leg ${a} and hypotenuse ${c}, other leg = ______`;
                        answer = b.toString();
                    } else {
                        problem = `Right triangle: legs ${a} and ${b}, hypotenuse = ______`;
                        answer = c.toString();
                    }
                    
                    return {
                        problem: problem,
                        answer: answer,
                        type: "Pythagorean theorem",
                        category: "geometry",
                        starred: false,
                        hint: `a² + b² = c²: ${a}² + ${b}² = ${a*a} + ${b*b} = ${a*a + b*b} = ${c}²`
                    };
                },
                
                // Problem 39-40: Binomial square pattern
                function() {
                    const a = randomInt(2, 6);
                    const b = randomInt(1, 4);
                    const sign = randomChoice(["+", "-"]);
                    const expanded = sign === "+" 
                        ? `${a*a}x² + ${2*a*b}x + ${b*b}`
                        : `${a*a}x² - ${2*a*b}x + ${b*b}`;
                    const sum = a*a + (sign === "+" ? 2*a*b : -2*a*b) + b*b;
                    return {
                        problem: `If (${a}x ${sign} ${b})² = kx² + mx + n, then k + m + n = ______`,
                        answer: sum.toString(),
                        type: "Binomial expansion",
                        category: "algebra",
                        starred: false,
                        hint: `(${a}x ${sign} ${b})² = ${expanded}, sum = ${sum}`
                    };
                }
            ],
            
            // ===== PROBLEMS 41-60 (Advanced Topics) =====
            "41-60": [
                // Problem 41-42: Complex sequences (Fibonacci-like)
                function() {
                    const a = randomInt(1, 5);
                    const b = randomInt(2, 6);
                    let sequence = [a, b];
                    for (let i = 2; i < 6; i++) {
                        sequence.push(sequence[i-2] + sequence[i-1]);
                    }
                    const sum = sequence.reduce((s, n) => s + n, 0);
                    return {
                        problem: `${sequence.join(" + ")} = ______`,
                        answer: sum.toString(),
                        type: "Fibonacci sequence",
                        category: "sequences",
                        starred: false,
                        hint: `Each term is sum of two previous: ${sequence.join(", ")}, sum = ${sum}`
                    };
                },
                
                // Problem 43-44: Complex number operations
                function() {
                    const a = randomInt(1, 5);
                    const b = randomInt(1, 5);
                    const c = randomInt(1, 5);
                    const d = randomInt(1, 5);
                    const real = a*c - b*d;
                    const imag = a*d + b*c;
                    return {
                        problem: `(${a} + ${b}i)(${c} + ${d}i) = a + bi, then a = ______`,
                        answer: real.toString(),
                        type: "Complex numbers",
                        category: "algebra",
                        starred: false,
                        hint: `(${a}×${c} - ${b}×${d}) + (${a}×${d} + ${b}×${c})i = ${real} + ${imag}i`
                    };
                },
                
                // Problem 45-46: Permutations/combinations
                function() {
                    const n = randomInt(5, 8);
                    const r = randomInt(2, 4);
                    const permutations = Math.floor(factorial(n) / factorial(n - r));
                    return {
                        problem: `${n}P${r} = ______`,
                        answer: permutations.toString(),
                        type: "Permutations",
                        category: "algebra",
                        starred: false,
                        hint: `${n}P${r} = ${n}!/(${n}-${r})! = ${permutations}`
                    };
                },
                
                // Problem 47-48: Probability
                function() {
                    const favorable = randomInt(1, 5);
                    const total = favorable + randomInt(3, 7);
                    const prob = favorable / total;
                    return {
                        problem: `Probability of choosing ${favorable} specific items from ${total} = ______`,
                        answer: prob.toString(),
                        type: "Probability",
                        category: "algebra",
                        starred: false,
                        hint: `Probability = ${favorable}/${total} = ${prob}`
                    };
                },
                
                // Problem 49-50: Logarithms
                function() {
                    const base = randomChoice([2, 3, 4, 5]);
                    const power = randomInt(2, 5);
                    const number = Math.pow(base, power);
                    return {
                        problem: `log_${base}(${number}) = ______`,
                        answer: power.toString(),
                        type: "Logarithms",
                        category: "algebra",
                        starred: false,
                        hint: `${base}^${power} = ${number}, so log_${base}(${number}) = ${power}`
                    };
                },
                
                // Problem 51-52: Trigonometry basics
                function() {
                    const angle = randomChoice([30, 45, 60]);
                    let func, value;
                    switch(angle) {
                        case 30:
                            func = randomChoice(["sin", "cos"]);
                            value = func === "sin" ? "1/2" : "√3/2";
                            break;
                        case 45:
                            func = randomChoice(["sin", "cos"]);
                            value = "√2/2";
                            break;
                        case 60:
                            func = randomChoice(["sin", "cos"]);
                            value = func === "sin" ? "√3/2" : "1/2";
                            break;
                    }
                    return {
                        problem: `${func}(${angle}°) = ______`,
                        answer: value,
                        type: "Trigonometry",
                        category: "geometry",
                        starred: false,
                        hint: `${func}(${angle}°) = ${value}`
                    };
                },
                
                // Problem 53-54: Determinants
                function() {
                    const a = randomInt(1, 5);
                    const b = randomInt(1, 5);
                    const c = randomInt(1, 5);
                    const d = randomInt(1, 5);
                    const det = a*d - b*c;
                    return {
                        problem: `det |${a} ${b}; ${c} ${d}| = ______`,
                        answer: det.toString(),
                        type: "Determinants",
                        category: "algebra",
                        starred: false,
                        hint: `${a}×${d} - ${b}×${c} = ${det}`
                    };
                },
                
                // Problem 55-56: Sum of series
                function() {
                    const n = randomInt(5, 10);
                    const sum = (n * (n + 1)) / 2;
                    return {
                        problem: `1 + 2 + 3 + ... + ${n} = ______`,
                        answer: sum.toString(),
                        type: "Sum of series",
                        category: "sequences",
                        starred: false,
                        hint: `Sum = n(n+1)/2 = ${n}×${n+1}/2 = ${sum}`
                    };
                },
                
                // Problem 57-58: Factorial patterns
                function() {
                    const n = randomInt(4, 7);
                    const k = randomInt(1, n-1);
                    const ratio = factorial(n) / factorial(k);
                    return {
                        problem: `${n}! / ${k}! = ______`,
                        answer: ratio.toString(),
                        type: "Factorials",
                        category: "algebra",
                        starred: false,
                        hint: `${n}! / ${k}! = ${n}×${n-1}×...×${k+1} = ${ratio}`
                    };
                },
                
                // Problem 59-60: Advanced estimation
                function() {
                    const a = randomInt(100, 300);
                    const b = randomInt(100, 300);
                    const c = randomInt(100, 300);
                    const sum = a + b + c;
                    const estimate = Math.round(sum / 100) * 100;
                    return {
                        problem: `${a} + ${b} + ${c} ≈ ______ (nearest hundred)`,
                        answer: estimate.toString(),
                        type: "Estimation",
                        category: "estimation",
                        starred: true,
                        hint: `${a}≈${Math.round(a/100)*100}, ${b}≈${Math.round(b/100)*100}, ${c}≈${Math.round(c/100)*100}, sum≈${estimate}`
                    };
                }
            ],
            
            // ===== PROBLEMS 61-70 (Trig/Matrices) =====
            "61-70": [
                // Trig identities, matrix multiplication, vectors
                function() {
                    const angle = randomChoice([0, 30, 45, 60, 90]);
                    const func = randomChoice(["sin", "cos", "tan"]);
                    let value;
                    switch(angle) {
                        case 0:
                            value = func === "sin" ? "0" : func === "cos" ? "1" : "0";
                            break;
                        case 30:
                            value = func === "sin" ? "1/2" : func === "cos" ? "√3/2" : "√3/3";
                            break;
                        case 45:
                            value = func === "sin" ? "√2/2" : func === "cos" ? "√2/2" : "1";
                            break;
                        case 60:
                            value = func === "sin" ? "√3/2" : func === "cos" ? "1/2" : "√3";
                            break;
                        case 90:
                            value = func === "sin" ? "1" : func === "cos" ? "0" : "undefined";
                            break;
                    }
                    return {
                        problem: `${func}(${angle}°) = ______`,
                        answer: value,
                        type: "Trigonometry",
                        category: "geometry",
                        starred: false,
                        hint: `${func}(${angle}°) = ${value}`
                    };
                },
                
                // Vector magnitude
                function() {
                    const x = randomInt(3, 8);
                    const y = randomInt(3, 8);
                    const magnitude = Math.sqrt(x*x + y*y).toFixed(2);
                    return {
                        problem: `Vector (${x}, ${y}) has magnitude ______`,
                        answer: magnitude,
                        type: "Vectors",
                        category: "geometry",
                        starred: false,
                        hint: `√(${x}² + ${y}²) = √${x*x + y*y} = ${magnitude}`
                    };
                }
            ],
            
            // ===== PROBLEMS 71-80 (Calculus) =====
            "71-80": [
                // Derivatives
                function() {
                    const n = randomInt(2, 4);
                    const coeff = randomInt(2, 5);
                    const power = randomInt(2, 4);
                    const derivative = coeff * power;
                    const newPower = power - 1;
                    return {
                        problem: `d/dx(${coeff}x^${power}) at x=${n} = ______`,
                        answer: (derivative * Math.pow(n, newPower)).toString(),
                        type: "Derivative",
                        category: "algebra",
                        starred: false,
                        hint: `Derivative = ${coeff*power}x^${power-1}, at x=${n} = ${coeff*power}×${n}^${power-1}`
                    };
                },
                
                // Simple integrals
                function() {
                    const a = randomInt(1, 3);
                    const b = randomInt(2, 4);
                    const integral = (a * b * b / 2) - (a * 0 / 2);
                    return {
                        problem: `∫[0 to ${b}] ${a}x dx = ______`,
                        answer: integral.toString(),
                        type: "Integral",
                        category: "algebra",
                        starred: false,
                        hint: `∫${a}x dx = ${a/2}x², from 0 to ${b} = ${integral}`
                    };
                }
            ]
        };
        
        // Helper function for factorial
        function factorial(n) {
            let result = 1;
            for (let i = 2; i <= n; i++) {
                result *= i;
            }
            return result;
        }
        
        // ===== PRACTICE MODE FUNCTIONS =====
        
        let currentProblems = [];
        let currentPracticeMode = '';
        let score = 0;
        let totalProblems = 0;
        let currentProblemIndex = 0;
        let missedProblems = [];
        let answerSubmitted = false;
        let currentProblemData = null;
        
        // Timer/stopwatch variables
        let stopwatchInterval = null;
        let stopwatchRunning = false;
        let stopwatchTime = 0;
        let stopwatchStartTime = 0;
        let timerInterval = null;
        
        function startStopwatch() {
            if (stopwatchRunning) return;
            stopwatchRunning = true;
            stopwatchStartTime = Date.now() - stopwatchTime;
            
            stopwatchInterval = setInterval(() => {
                stopwatchTime = Date.now() - stopwatchStartTime;
                updateStopwatchDisplay();
            }, 100);
        }
        
        function pauseStopwatch() {
            stopwatchRunning = false;
            if (stopwatchInterval) {
                clearInterval(stopwatchInterval);
                stopwatchInterval = null;
            }
        }
        
        function resetStopwatch() {
            stopwatchTime = 0;
            updateStopwatchDisplay();
            if (stopwatchRunning) {
                stopwatchStartTime = Date.now();
            }
        }
        
        function updateStopwatchDisplay() {
            const hours = Math.floor(stopwatchTime / 3600000);
            const minutes = Math.floor((stopwatchTime % 3600000) / 60000);
            const seconds = Math.floor((stopwatchTime % 60000) / 1000);
            const display = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            document.getElementById('stopwatch-display').textContent = display;
        }
        
        function formatStopwatchTime() {
            const minutes = Math.floor(stopwatchTime / 60000);
            const seconds = Math.floor((stopwatchTime % 60000) / 1000);
            return `${minutes}m ${seconds}s`;
        }
        
        // ===== UI MANAGEMENT =====
        
        function showMainMenu() {
            document.getElementById('main-menu').classList.remove('hidden');
            document.getElementById('section-menu').classList.add('hidden');
            document.getElementById('category-menu').classList.add('hidden');
            document.getElementById('practice-screen').classList.add('hidden');
            document.getElementById('results-screen').classList.add('hidden');
            document.getElementById('review-screen').classList.add('hidden');
            document.getElementById('pattern-info').classList.add('hidden');
            document.getElementById('instructions').classList.add('hidden');
        }
        
        function showSectionMenu() {
            document.getElementById('main-menu').classList.add('hidden');
            document.getElementById('section-menu').classList.remove('hidden');
        }
        
        function showCategoryMenu() {
            document.getElementById('main-menu').classList.add('hidden');
            document.getElementById('category-menu').classList.remove('hidden');
        }
        
        function showPatternInfo() {
            document.getElementById('main-menu').classList.add('hidden');
            document.getElementById('pattern-info').classList.remove('hidden');
        }
        
        function showInstructions() {
            document.getElementById('main-menu').classList.add('hidden');
            document.getElementById('instructions').classList.remove('hidden');
        }
        
        // ===== PRACTICE SESSION FUNCTIONS =====
        
        function startQuickPractice() {
            currentPracticeMode = 'quick';
            currentProblems = [];
            
            // Mix of problems from different sections
            for (let i = 0; i < 4; i++) {
                const generator = randomChoice(problemPatterns["1-20"]);
                currentProblems.push(generator());
            }
            for (let i = 0; i < 3; i++) {
                const generator = randomChoice(problemPatterns["21-40"]);
                currentProblems.push(generator());
            }
            for (let i = 0; i < 3; i++) {
                const generator = randomChoice(problemPatterns["41-60"]);
                currentProblems.push(generator());
            }
            
            startPracticeSession(currentProblems.length);
        }
        
        function startFullTest() {
            if (!confirm("Ready to begin? You'll have 10 minutes for 80 problems.")) {
                return;
            }
            
            currentPracticeMode = 'full';
            currentProblems = [];
            
            // Generate full 80-problem test following UIL sequence
            const sections = ["1-20", "21-40", "41-60", "61-70", "71-80"];
            const counts = [20, 20, 20, 10, 10]; // 80 total
            
            for (let s = 0; s < sections.length; s++) {
                const section = sections[s];
                const count = counts[s];
                const generators = problemPatterns[section];
                
                for (let i = 0; i < count; i++) {
                    const generator = randomChoice(generators);
                    currentProblems.push(generator());
                }
            }
            
            startPracticeSession(80, 600); // 10 minutes
        }
        
        function startSectionPractice(sectionIndex) {
            currentPracticeMode = 'section';
            const sections = ["1-20", "21-40", "41-60", "61-70", "71-80"];
            const section = sections[sectionIndex];
            const generators = problemPatterns[section];
            
            currentProblems = [];
            for (let i = 0; i < 10; i++) {
                const generator = randomChoice(generators);
                currentProblems.push(generator());
            }
            
            startPracticeSession(10);
        }
        
        function startCategoryPractice(category) {
            currentPracticeMode = 'category';
            currentProblems = [];
            
            // Collect problems from all sections that match the category
            const allGenerators = [
                ...problemPatterns["1-20"],
                ...problemPatterns["21-40"],
                ...problemPatterns["41-60"],
                ...problemPatterns["61-70"],
                ...problemPatterns["71-80"]
            ];
            
            // Generate problems until we have 10 of the right category
            while (currentProblems.length < 10) {
                const generator = randomChoice(allGenerators);
                const problem = generator();
                if (problem.category === category) {
                    currentProblems.push(problem);
                }
            }
            
            startPracticeSession(10);
        }
        
        function startEstimationPractice() {
            currentPracticeMode = 'estimation';
            currentProblems = [];
            
            // Collect all estimation problems
            const allGenerators = [
                ...problemPatterns["1-20"],
                ...problemPatterns["21-40"],
                ...problemPatterns["41-60"],
                ...problemPatterns["61-70"],
                ...problemPatterns["71-80"]
            ];
            
            // Generate problems until we have 10 estimation problems
            while (currentProblems.length < 10) {
                const generator = randomChoice(allGenerators);
                const problem = generator();
                if (problem.starred) {
                    currentProblems.push(problem);
                }
            }
            
            startPracticeSession(10);
        }
        
        function startPracticeSession(total, timeLimit = null) {
            score = 0;
            totalProblems = total;
            currentProblemIndex = 0;
            missedProblems = [];
            answerSubmitted = false;
            
            // Reset stopwatch
            resetStopwatch();
            if (timeLimit === null) {
                startStopwatch();
            }
            
            // Show practice screen
            document.getElementById('main-menu').classList.add('hidden');
            document.getElementById('practice-screen').classList.remove('hidden');
            document.getElementById('feedback').classList.add('hidden');
            document.getElementById('answer-input').value = '';
            document.getElementById('answer-input').disabled = false;
            document.getElementById('submit-btn').classList.remove('hidden');
            document.getElementById('next-btn').classList.add('hidden');
            document.getElementById('answer-input').focus();
            
            // Setup timer
            if (timeLimit) {
                startTimer(timeLimit);
                document.getElementById('timer').style.display = 'block';
                document.getElementById('stopwatch').style.display = 'none';
            } else {
                startTimer(0);
                document.getElementById('timer').style.display = 'none';
                document.getElementById('stopwatch').style.display = 'flex';
            }
            
            showCurrentProblem();
        }
        
        function showCurrentProblem() {
            currentProblemData = currentProblems[currentProblemIndex];
            document.getElementById('problem-display').textContent = currentProblemData.problem;
            document.getElementById('problem-counter').textContent = 
                `Problem ${currentProblemIndex + 1} of ${totalProblems}`;
            document.getElementById('problem-info').textContent = 
                `Type: ${currentProblemData.type} | Category: ${currentProblemData.category}`;
            document.getElementById('answer-input').value = '';
            document.getElementById('answer-input').disabled = false;
            document.getElementById('submit-btn').classList.remove('hidden');
            document.getElementById('next-btn').classList.add('hidden');
            document.getElementById('feedback').classList.add('hidden');
            answerSubmitted = false;
            document.getElementById('answer-input').focus();
        }
        
        function startTimer(timeLimit) {
            if (timerInterval) clearInterval(timerInterval);
            
            if (timeLimit === 0) {
                document.getElementById('timer').textContent = '';
                return;
            }
            
            const startTime = Date.now();
            const endTime = startTime + (timeLimit * 1000);
            
            timerInterval = setInterval(() => {
                const now = Date.now();
                const remaining = Math.max(0, endTime - now);
                const minutes = Math.floor(remaining / 60000);
                const seconds = Math.floor((remaining % 60000) / 1000);
                
                document.getElementById('timer').textContent = 
                    `Time: ${minutes}:${seconds.toString().padStart(2, '0')}`;
                
                if (remaining === 0) {
                    clearInterval(timerInterval);
                    endPracticeSession();
                }
            }, 1000);
        }
        
        function checkAnswer(userInput, correctAnswer, problemType) {
            userInput = userInput.trim().toLowerCase();
            
            if (userInput === "skip" || userInput === "") {
                return "skip";
            }
            
            if (userInput === "quit") {
                return "quit";
            }
            
            // For estimation problems, allow 5% error
            if (problemType === "Estimation" || currentProblemData.starred) {
                const userNum = parseFloat(userInput);
                const correctNum = parseFloat(correctAnswer);
                if (isNaN(userNum) || isNaN(correctNum)) {
                    return userInput === correctAnswer.toLowerCase() ? "correct" : "incorrect";
                }
                const tolerance = Math.abs(correctNum * 0.05);
                return Math.abs(userNum - correctNum) <= tolerance ? "correct" : "incorrect";
            }
            
            // For exact answers
            return userInput === correctAnswer.toString().toLowerCase() ? "correct" : "incorrect";
        }
        
        function submitAnswer() {
            if (answerSubmitted) return;
            
            const userAnswer = document.getElementById('answer-input').value.trim();
            const result = checkAnswer(userAnswer, currentProblemData.answer, currentProblemData.type);
            
            const feedback = document.getElementById('feedback');
            feedback.classList.remove('hidden');
            
            if (result === "skip") {
                feedback.innerHTML = `<span class="skipped">↷ SKIPPED</span><br>`;
                feedback.innerHTML += `Correct answer: ${currentProblemData.answer}<br>`;
                if (currentProblemData.hint) {
                    feedback.innerHTML += `Hint: ${currentProblemData.hint}`;
                }
                
                missedProblems.push(currentProblemData);
            } else if (result === "quit") {
                quitPractice();
                return;
            } else if (result === "correct") {
                feedback.innerHTML = `<span class="correct">✓ CORRECT!</span><br>`;
                feedback.innerHTML += `Answer: ${currentProblemData.answer}`;
                if (currentProblemData.starred) {
                    feedback.innerHTML += `<br><em>(Estimation: within 5% of exact answer)</em>`;
                }
                score++;
            } else {
                feedback.innerHTML = `<span class="incorrect">✗ INCORRECT</span><br>`;
                feedback.innerHTML += `Your answer: ${userAnswer}<br>`;
                feedback.innerHTML += `Correct answer: ${currentProblemData.answer}<br>`;
                if (currentProblemData.hint) {
                    feedback.innerHTML += `Hint: ${currentProblemData.hint}`;
                }
                if (currentProblemData.starred) {
                    feedback.innerHTML += `<br><em>(Estimation: within 5% of exact answer)</em>`;
                }
                
                missedProblems.push(currentProblemData);
            }
            
            document.getElementById('answer-input').disabled = true;
            document.getElementById('submit-btn').classList.add('hidden');
            document.getElementById('next-btn').classList.remove('hidden');
            answerSubmitted = true;
        }
        
        function nextQuestion() {
            currentProblemIndex++;
            
            if (currentProblemIndex < totalProblems) {
                showCurrentProblem();
            } else {
                endPracticeSession();
            }
        }
        
        function skipProblem() {
            if (answerSubmitted) {
                nextQuestion();
            } else {
                document.getElementById('answer-input').value = 'skip';
                submitAnswer();
            }
        }
        
        function quitPractice() {
            pauseStopwatch();
            if (timerInterval) clearInterval(timerInterval);
            endPracticeSession();
        }
        
        function endPracticeSession() {
            pauseStopwatch();
            if (timerInterval) clearInterval(timerInterval);
            
            const percentage = totalProblems > 0 ? Math.round((score / totalProblems) * 100) : 0;
            
            let resultsHTML = `
                <p><strong>Practice Mode:</strong> ${currentPracticeMode}</p>
                <p><strong>Problems attempted:</strong> ${totalProblems}</p>
                <p><strong>Correct:</strong> ${score}</p>
                <p><strong>Score:</strong> ${score}/${totalProblems}</p>
                <p><strong>Percentage:</strong> ${percentage}%</p>
            `;
            
            if (currentPracticeMode !== 'full') {
                resultsHTML += `<p><strong>Time:</strong> ${formatStopwatchTime()}</p>`;
                const avgTime = stopwatchTime / totalProblems;
                const avgSeconds = avgTime / 1000;
                resultsHTML += `<p><strong>Average time per problem:</strong> ${avgSeconds.toFixed(1)} seconds</p>`;
            }
            
            if (missedProblems.length > 0) {
                resultsHTML += `<p><strong>Missed/Skipped:</strong> ${missedProblems.length}</p>`;
            }
            
            // Performance feedback
            if (percentage >= 90) {
                resultsHTML += `<p><strong>Excellent! National champion level!</strong></p>`;
            } else if (percentage >= 80) {
                resultsHTML += `<p><strong>Great job! Regional finalist level!</strong></p>`;
            } else if (percentage >= 70) {
                resultsHTML += `<p><strong>Good work! Keep practicing!</strong></p>`;
            } else if (percentage >= 60) {
                resultsHTML += `<p><strong>Not bad, but needs more practice.</strong></p>`;
            } else {
                resultsHTML += `<p><strong>Keep working - focus on fundamentals.</strong></p>`;
            }
            
            // Category breakdown if available
            if (currentPracticeMode === 'quick' || currentPracticeMode === 'full') {
                const categoryCount = {};
                currentProblems.forEach(p => {
                    categoryCount[p.category] = (categoryCount[p.category] || 0) + 1;
                });
                resultsHTML += `<p><strong>Problem Categories:</strong> `;
                for (const [cat, count] of Object.entries(categoryCount)) {
                    resultsHTML += `${cat} (${count}), `;
                }
                resultsHTML = resultsHTML.slice(0, -2) + '</p>';
            }
            
            document.getElementById('results-display').innerHTML = resultsHTML;
            document.getElementById('practice-screen').classList.add('hidden');
            document.getElementById('results-screen').classList.remove('hidden');
        }
        
        // ===== REVIEW FUNCTIONS =====
        
        function reviewMissed() {
            if (missedProblems.length === 0) {
                alert("No missed problems to review yet. Complete a practice session first!");
                return;
            }
            
            reviewIndex = 0;
            document.getElementById('results-screen').classList.add('hidden');
            document.getElementById('review-screen').classList.remove('hidden');
            showReviewItem();
        }
        
        function showReviewItem() {
            if (reviewIndex >= missedProblems.length) {
                reviewIndex = 0;
            }
            
            const item = missedProblems[reviewIndex];
            let reviewHTML = `
                <p><strong>Problem ${reviewIndex + 1} of ${missedProblems.length}</strong></p>
                <p><strong>Problem:</strong> ${item.problem}</p>
                <p><strong>Type:</strong> ${item.type}</p>
                <p><strong>Category:</strong> ${item.category}</p>
                <p><strong>Correct answer:</strong> ${item.answer}</p>
            `;
            
            if (item.hint) {
                reviewHTML += `<p><strong>Solution:</strong> ${item.hint}</p>`;
            }
            
            if (item.starred) {
                reviewHTML += `<p><em>Estimation problem: answers within 5% are correct</em></p>`;
            }
            
            document.getElementById('review-display').innerHTML = reviewHTML;
        }
        
        function previousReview() {
            reviewIndex = (reviewIndex - 1 + missedProblems.length) % missedProblems.length;
            showReviewItem();
        }
        
        function nextReview() {
            reviewIndex = (reviewIndex + 1) % missedProblems.length;
            showReviewItem();
        }
        
        // ===== KEYBOARD SHORTCUTS =====
        
        document.addEventListener('keydown', function(event) {
            const input = document.getElementById('answer-input');
            if (!answerSubmitted && input && document.activeElement === input) {
                if (event.key === 'Enter') {
                    submitAnswer();
                } else if (event.key === 'Escape') {
                    skipProblem();
                } else if (event.key === 'q' || event.key === 'Q') {
                    quitPractice();
                }
            } else if (answerSubmitted) {
                if (event.key === 'Enter' || event.key === 'n' || event.key === 'N') {
                    nextQuestion();
                } else if (event.key === 'q' || event.key === 'Q') {
                    quitPractice();
                }
            }
        });
        
        // Initialize
        showMainMenu();
    </script>
</body>
</html>